<tree schema_version="1.0">
    <sourceName>Kinetic Request CE</sourceName>
    <sourceGroup>WebApis > calendar</sourceGroup>
    <type>Tree</type>
    <status>Active</status>
    <taskTree builder_version="" schema_version="1.0" version="">
        <name>netsuite-initiated</name>
        <author></author>
        <notes></notes>
        <lastID>41</lastID>
        <request>
            <task definition_id="system_start_v1" id="start" name="Start" x="99" y="214">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_tree_return_v1_1</task>
                    <task label="Opportunity" type="Complete" value="JSON.parse(@request['Body']).has_key?(&quot;opportunity&quot;)">utilities_echo_v1_4</task>
                    <task label="Schedule" type="Complete" value="JSON.parse(@request['Body']).has_key?(&quot;schedule&quot;)">utilities_echo_v1_6</task>
                    <task label="Event" type="Complete" value="JSON.parse(@request['Body']).has_key?(&quot;event&quot;)">utilities_echo_v1_41</task>
                </dependents>
            </task>
            <task definition_id="system_tree_return_v1" id="system_tree_return_v1_1" name="Return 200" x="55" y="99">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="content" label="Content" menu="" required="false" tooltip=""></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="content_type" label="Content Type" menu="" required="false" tooltip="">application/json</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="headers_json" label="Headers (JSON)" menu="" required="false" tooltip="">{}</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="response_code" label="Response Code" menu="" required="false" tooltip="">200</parameter>
                </parameters>
                <messages></messages>
                <dependents></dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_4" name="Opportunity JSON" x="368" y="217">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= JSON.parse(@request['Body'])['opportunity'].to_json %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">routine_kinetic_submissions_retrieve_list_v1_5</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submissions_retrieve_list_v1" id="routine_kinetic_submissions_retrieve_list_v1_5" name="Retrieve Current Opportunity Record" x="692" y="218">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to find submissions in.">calendar</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Slug" label="Form Slug" menu="" required="false" tooltip="The slug of the Form to find submissions in. If none provided, can only use Kapp Fields in search query">opportunities</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Type" label="Form Type" menu="" required="false" tooltip="The Type of Form to find submissions in."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Core State" label="Core State" menu="" required="false" tooltip="Searches for submissions that have a core state that matches this parameter. If no value is provided, the results will contain submissions in all core states."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Limit" label="Limit" menu="" required="false" tooltip="Limit the number of results returned. If not provided, the server will limit the results to 25 submissions. Maximum limit 1000">1000</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Query" label="Query" menu="" required="false" tooltip="Query to use to fetch submissions. (i.e values[First Name]=&quot;Fred&quot;)">values[Opportunity Id]="&lt;%= JSON.parse(@results['Opportunity JSON']['output'])['internalid'] %&gt;"</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Timeline" label="Timeline" menu="" required="false" tooltip="Date property to search by. The default value is createdAt."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Direction" label="Direction" menu="" required="false" tooltip="Result Set sorting direction. The default value is descending."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Start Date/Time" label="Start Date/Time" menu="" required="false" tooltip="Start date/time of the timeline. This value should be used to both refine and limit the search results. Format should be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="End Date/Time" label="End Date/Time" menu="" required="false" tooltip="End date/time of the timeline. This value should be used to both refine and limit the search results. Formatshould be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Next Page Token" label="Next Page Token" menu="" required="false" tooltip="The value to use as the offset for the page of submissions to return. The submission that matches this value will not be included in the results."></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_37</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_6" name="Schedule JSON" x="57" y="402">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= JSON.parse(@request['Body'])['schedule'].to_json %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="Valid" type="Complete" value="JSON.parse(@results['Schedule JSON']['output']).has_key?('custrecord_ts_location_room') &amp;&amp; !JSON.parse(@results['Schedule JSON']['output'])['custrecord_ts_location_room'].nil? &amp;&amp; !JSON.parse(@results['Schedule JSON']['output'])['custrecord_ts_location_room'].empty?">utilities_echo_v1_17</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submissions_retrieve_list_v1" id="routine_kinetic_submissions_retrieve_list_v1_7" name="Retrieve Current Schedule Record" x="968.6666" y="617.8889">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to find submissions in.">calendar</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Slug" label="Form Slug" menu="" required="false" tooltip="The slug of the Form to find submissions in. If none provided, can only use Kapp Fields in search query">schedules</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Type" label="Form Type" menu="" required="false" tooltip="The Type of Form to find submissions in."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Core State" label="Core State" menu="" required="false" tooltip="Searches for submissions that have a core state that matches this parameter. If no value is provided, the results will contain submissions in all core states."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Limit" label="Limit" menu="" required="false" tooltip="Limit the number of results returned. If not provided, the server will limit the results to 25 submissions. Maximum limit 1000">1000</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Query" label="Query" menu="" required="false" tooltip="Query to use to fetch submissions. (i.e values[First Name]=&quot;Fred&quot;)">values[Schedule Id]="&lt;%= JSON.parse(@results['Schedule JSON']['output'])['internalid'] %&gt;"</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Timeline" label="Timeline" menu="" required="false" tooltip="Date property to search by. The default value is createdAt."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Direction" label="Direction" menu="" required="false" tooltip="Result Set sorting direction. The default value is descending."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Start Date/Time" label="Start Date/Time" menu="" required="false" tooltip="Start date/time of the timeline. This value should be used to both refine and limit the search results. Format should be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="End Date/Time" label="End Date/Time" menu="" required="false" tooltip="End date/time of the timeline. This value should be used to both refine and limit the search results. Formatshould be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Next Page Token" label="Next Page Token" menu="" required="false" tooltip="The value to use as the offset for the page of submissions to return. The submission that matches this value will not be included in the results."></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_30</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_create_v1" id="routine_kinetic_submission_create_v1_8" name="Create Opportunity Record" x="1336" y="220">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to create the submission in">calendar</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Slug" label="Form Slug" menu="" required="true" tooltip="The slug of the Form to create the submission in">opportunities</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Current Page Name" label="Current Page Name" menu="" required="false" tooltip="The page to set the submission to"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Current Page Navigation" label="Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Values JSON" label="Values JSON" menu="" required="false" tooltip="A JSON Map of values to set into the submissions fields">&lt;%= @results['Opportunity Values']['output'] %&gt;</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Origin Id" label="Origin Id" menu="" required="false" tooltip="Sets the submissions origin to another Kinetic Submission"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Parent Id" label="Parent Id" menu="" required="false" tooltip="Sets the submissions parent to another Kinetic Submission"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Submit Submission" label="Submit Submission" menu="" required="false" tooltip="True or False, if Submission should be Submitted when created">true</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_13</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_update_v1" id="routine_kinetic_submission_update_v1_9" name="Update Opportunity Record" x="969" y="399">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Id" label="Id" menu="" required="true" tooltip="The id of the submission to update">&lt;%= JSON.parse(@results['Retrieve Current Opportunity Record']['Submissions List JSON'])[0]['id'] %&gt;</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Core State" label="Updated - Core State" menu="" required="false" tooltip="The submissions core state"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Current Page Name" label="Updated - Current Page Name" menu="" required="false" tooltip="The page to set the submission to"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Current Page Navigation" label="Updated - Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Origin Id" label="Updated - Origin Id" menu="" required="false" tooltip="The Id of the submissions origin"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Parent Id" label="Updated - Parent Id" menu="" required="false" tooltip="The Id of the submissions parent"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Values JSON" label="Updated - Values JSON" menu="" required="false" tooltip="A JSON representation of the submissions values">&lt;%= @results['Opportunity Values']['output'] %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_13</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_create_v1" id="routine_kinetic_submission_create_v1_10" name="Create Schedule Record" x="1512.4445" y="617.8889">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to create the submission in">calendar</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Slug" label="Form Slug" menu="" required="true" tooltip="The slug of the Form to create the submission in">schedules</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Current Page Name" label="Current Page Name" menu="" required="false" tooltip="The page to set the submission to"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Current Page Navigation" label="Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Values JSON" label="Values JSON" menu="" required="false" tooltip="A JSON Map of values to set into the submissions fields">&lt;%= @results['Schedule Values']['output'] %&gt;</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Origin Id" label="Origin Id" menu="" required="false" tooltip="Sets the submissions origin to another Kinetic Submission"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Parent Id" label="Parent Id" menu="" required="false" tooltip="Sets the submissions parent to another Kinetic Submission"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Submit Submission" label="Submit Submission" menu="" required="false" tooltip="True or False, if Submission should be Submitted when created">true</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_14</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_update_v1" id="routine_kinetic_submission_update_v1_11" name="Update Schedule Record" x="1752" y="804.3334">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Id" label="Id" menu="" required="true" tooltip="The id of the submission to update">&lt;%= JSON.parse(@results['Retrieve Current Schedule Record']['Submissions List JSON'])[0]['id'] %&gt;</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Core State" label="Updated - Core State" menu="" required="false" tooltip="The submissions core state"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Current Page Name" label="Updated - Current Page Name" menu="" required="false" tooltip="The page to set the submission to"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Current Page Navigation" label="Updated - Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Origin Id" label="Updated - Origin Id" menu="" required="false" tooltip="The Id of the submissions origin"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Parent Id" label="Updated - Parent Id" menu="" required="false" tooltip="The Id of the submissions parent"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Updated - Values JSON" label="Updated - Values JSON" menu="" required="false" tooltip="A JSON representation of the submissions values">&lt;%= @results['Schedule Values']['output'] %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_14</task>
                </dependents>
            </task>
            <task definition_id="system_junction_v1" id="system_junction_v1_13" name="Junction - Opportunity" x="1334" y="409">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_15</task>
                </dependents>
            </task>
            <task definition_id="system_junction_v1" id="system_junction_v1_14" name="Junction - Schedule" x="1747.8889" y="628.8889">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_15</task>
                </dependents>
            </task>
            <task definition_id="system_join_v1" id="system_join_v1_15" name="Join" x="1750" y="506">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="type" label="Type:" menu="All,Any,Some" required="true" tooltip="How many dependents must be completed before continuing?">Any</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">routine_kinetic_finish_v1_16</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_finish_v1" id="routine_kinetic_finish_v1_16" name="Finish" x="2087" y="491">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Run Id" label="Run Id" menu="" required="false" tooltip="The Id of the completed run">&lt;%= @run['Id'] %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents></dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_17" name="Extract Rooms" x="57" y="819">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= JSON.parse(@results['Schedule JSON']['output'])['custrecord_ts_location_room'].split(",").to_json %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_head_v1_18</task>
                </dependents>
            </task>
            <task definition_id="system_loop_head_v1" id="system_loop_head_v1_18" name="Loop Begin - Rooms" x="369" y="818.44446">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="data_source" label="Data Source:" menu="" required="true" tooltip="The source that contains the data to use to create each task in the loop.">&lt;%= @results['Extract Rooms']['output'] %&gt;</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="loop_path" label="Loop Path:" menu="" required="true" tooltip="The XPath or JSONPath statement to indicate what data records to process.">$.[*]</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="var_name" label="Variable Name:" menu="" required="false" tooltip="The local variable name used to represent the data used in loop tasks."></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_tail_v1_19</task>
                    <task label="" type="Complete" value="">routine_kinetic_submissions_retrieve_list_v1_20</task>
                </dependents>
            </task>
            <task definition_id="system_loop_tail_v1" id="system_loop_tail_v1_19" name="Loop End - Rooms" x="693.2222" y="1339.1111">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="type" label="Type:" menu="All,Some,Any" required="true" tooltip="How many loop processes must be completed before continuing?">All</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_26</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submissions_retrieve_list_v1" id="routine_kinetic_submissions_retrieve_list_v1_20" name="Retrieve Room Record" x="367.8889" y="1000.2222">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to find submissions in.">calendar</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Slug" label="Form Slug" menu="" required="false" tooltip="The slug of the Form to find submissions in. If none provided, can only use Kapp Fields in search query">rooms</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Form Type" label="Form Type" menu="" required="false" tooltip="The Type of Form to find submissions in."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Core State" label="Core State" menu="" required="false" tooltip="Searches for submissions that have a core state that matches this parameter. If no value is provided, the results will contain submissions in all core states."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Limit" label="Limit" menu="" required="false" tooltip="Limit the number of results returned. If not provided, the server will limit the results to 25 submissions. Maximum limit 1000">1000</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Query" label="Query" menu="" required="false" tooltip="Query to use to fetch submissions. (i.e values[First Name]=&quot;Fred&quot;)">values[Room Id NetSuite]="&lt;%= JSON.parse(@results['Loop Begin - Rooms']['Value']) %&gt;"</parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Timeline" label="Timeline" menu="" required="false" tooltip="Date property to search by. The default value is createdAt."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Direction" label="Direction" menu="" required="false" tooltip="Result Set sorting direction. The default value is descending."></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Start Date/Time" label="Start Date/Time" menu="" required="false" tooltip="Start date/time of the timeline. This value should be used to both refine and limit the search results. Format should be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="End Date/Time" label="End Date/Time" menu="" required="false" tooltip="End date/time of the timeline. This value should be used to both refine and limit the search results. Formatshould be yyyy-MM-dd'T'HH:mm:ss'Z'"></parameter>
                    <parameter dependsOnId="" dependsOnValue="" id="Next Page Token" label="Next Page Token" menu="" required="false" tooltip="The value to use as the offset for the page of submissions to return. The submission that matches this value will not be included in the results."></parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_23</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_21" name="Rooms Array" x="692.2222" y="819.6666">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=

rooms = []
@results['Extract Room Id'].collect{|key,value|
  rooms.push("#{value['output']}")
}.compact

rooms.to_json
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_24</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_23" name="Extract Room Id" x="368.2222" y="1172.1111">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= 
raw = JSON.parse(@results['Retrieve Room Record']['Submissions List JSON'])[0]['values']['Room Id']
raw
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_25</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_24" name="Location Id" x="692" y="618">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=

location = []
@results['Extract Location Id'].collect{|key,value|
  location.push("#{value['output']}")
}.uniq.compact

location.to_json
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">routine_kinetic_submissions_retrieve_list_v1_7</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_25" name="Extract Location Id" x="368" y="1340">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= 
raw = JSON.parse(@results['Retrieve Room Record']['Submissions List JSON'])[0]['values']['Location Id']
raw
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_tail_v1_19</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_26" name="Build Start-End Date-Times" x="692.2222" y="1171.1111">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
sched = JSON.parse(@results['Schedule JSON']['output'])
#start_dt = DateTime.strptime(sched['custrecord_ts_start_datetime'], "%m/%d/%Y %r")
#end_dt = DateTime.strptime(sched['custrecord_ts_end_datetime'], "%m/%d/%Y %r")
start_dt = DateTime.strptime(sched['custrecord_ts_start_date'], "%m/%d/%Y")
end_dt = DateTime.strptime(sched['custrecord_ts_end_date'], "%m/%d/%Y")
{
  'start_datetime' =&gt; start_dt,
  'end_datetime' =&gt; end_dt
}.to_json 
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_27</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_27" name="Calculate Date Bucket" x="692.2222" y="999.6666">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
require 'time'

start_time_string = JSON.parse(@results['Build Start-End Date-Times']['output'])['start_datetime']
end_time_string = JSON.parse(@results['Build Start-End Date-Times']['output'])['end_datetime']

#
# Generates the buckets for each day, month, and year between
# the start and end times.
#
buckets = [];

## Get the start and end dates
start = Time.parse(start_time_string).utc
end_time = Time.parse(end_time_string).utc

## Patterns
yearPattern = "%Y"
monthPattern = "%Y-%m"
dayPattern = "%Y-%m-%d"
#hourPattern = "%Y-%m-%d-%H"

## Get the start month and year buckets
lastBucketDay = start.strftime(dayPattern)
lastBucketMonth = start.strftime(monthPattern)
lastBucketYear = start.strftime(yearPattern)

## Add the start buckets
#buckets.push(start.strftime(hourPattern))
buckets.push(lastBucketDay)
buckets.push(lastBucketMonth)
buckets.push(lastBucketYear)
## Add the end buckets
#if (start.strftime(hourPattern) &lt; end_time.strftime(hourPattern))
#  buckets.push(end_time.strftime(hourPattern))
#end
if (start.strftime(dayPattern) &lt; end_time.strftime(dayPattern))
  buckets.push(end_time.strftime(dayPattern))
end
if (start.strftime(monthPattern) &lt; end_time.strftime(monthPattern))
  buckets.push(end_time.strftime(monthPattern))
end
if (start.strftime(yearPattern) &lt; end_time.strftime(yearPattern))
  buckets.push(end_time.strftime(yearPattern))
end

# Add each day bucket in between the start and end
#while ((start+=(60*60)).strftime(hourPattern) &lt; end_time.strftime(hourPattern))
while ((start+=(60*60)).strftime(dayPattern) &lt; end_time.strftime(dayPattern))
  #buckets.push(start.strftime(hourPattern))
  # Add each new day bucket
  if (start.strftime(dayPattern) &lt; end_time.strftime(dayPattern) &amp;&amp; start.strftime(dayPattern) &gt; lastBucketDay)
      lastBucketDay = start.strftime(dayPattern)
      buckets.push(lastBucketDay)
  end
  # Add each new month bucket
  if (start.strftime(monthPattern) &lt; end_time.strftime(monthPattern) &amp;&amp; start.strftime(monthPattern) &gt; lastBucketMonth)
      lastBucketMonth = start.strftime(monthPattern)
      buckets.push(lastBucketMonth)
  end
  # Add each new year bucket
  if (start.strftime(yearPattern) &lt; end_time.strftime(yearPattern) &amp;&amp; start.strftime(yearPattern) &gt; lastBucketYear)
      lastBucketYear = start.strftime(yearPattern)
      buckets.push(lastBucketYear)
  end
end

# Sort and removing duplicates
buckets.sort!
buckets.uniq!

buckets.to_json
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_21</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_30" name="Schedule Values" x="1227" y="616.3334">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
sched = JSON.parse(@results['Schedule JSON']['output'])
loc = JSON.parse(@results['Location Id']['output'])
time = JSON.parse(@results['Build Start-End Date-Times']['output'])

{
 'Status' =&gt; "Active",
 'Opportunity Id' =&gt; sched['custrecord_ts_opportunity'],
 'Location Id' =&gt; loc[0],
 'Room Id' =&gt; JSON.parse(@results['Rooms Array']['output']),
 'Start Time' =&gt; DateTime.parse(sched['custrecord_ts_start_time']).strftime("%H:%M"),
 'End Time' =&gt; DateTime.parse(sched['custrecord_ts_end_time']).strftime("%H:%M"),
 'Start Date' =&gt; DateTime.strptime(sched['custrecord_ts_start_date'], "%m/%d/%Y").strftime("%Y-%m-%d"),
 'End Date' =&gt; DateTime.strptime(sched['custrecord_ts_end_date'], "%m/%d/%Y").strftime("%Y-%m-%d"), 
 'Date Bucket' =&gt; JSON.parse(@results['Calculate Date Bucket']['output']),
 'Schedule Create Date' =&gt; DateTime.strptime(sched['custrecord_ts_opp_date_created'], "%m/%d/%Y").strftime("%Y-%m-%d"), 
 'Schedule Id' =&gt; sched['internalid'],
 'Schedule Status' =&gt; sched['custrecord_ts_status'], #This is set from the Opportunities Status
 'Customer' =&gt; sched['custrecord_ts_opp_customer'],
 'Opportunity URL' =&gt; sched['custrecord_ts_opp_url'],
 'Sales Rep' =&gt; sched['custrecord_ts_sales_rep'],
 'Methodology' =&gt; sched['custrecord_ts_study_methodology'],
 'Equipment' =&gt; sched['custrecord_ts_equipment_requirements'],
 'Project' =&gt; sched['custrecord_ts_project'],
 'Project URL' =&gt; sched['custrecord_ts_project_url'],    
 'Project Manager' =&gt; sched['custrecord_ts_project_manager'], 
 'Recruit Manager' =&gt; sched['custrecord_ts_recruit_manager'],  
 'Client On-Site' =&gt; (sched['custrecord_ts_client_onsite'] == "T") ? ["true"] : [],
 'Parent - Child' =&gt; (sched['custrecord_ts_parent_child'] == "T") ? ["Yes"] : [],
 'Proctor' =&gt; (sched['custrecord_ts_proctor2']=="T") ? ["Yes"] : [],
 'N per Facility' =&gt; sched['custrecord_ts_n_per_facility'],
 'Number of Visits' =&gt; sched['custrecord_ts_num_days_visits'],
 'Session Length' =&gt; sched['custrecord_ts_session_length'],
 'Incentive Amount' =&gt; sched['custrecord_ts_incentive_amount'],
 'Session Times' =&gt; sched['custrecord_ts_session_times'],
 'Pairs' =&gt; (sched['custrecord_ts_pairs'] == "Yes") ? ["Yes"] : [],
 'Kids Only' =&gt; (sched['custrecord_ts_kids_only'] == "Yes") ? ["Yes"] : [], 
 'Comments' =&gt; sched['custrecord_ts_comments'],
 'Job Number' =&gt; sched['custrecord_ts_j_num'],
 'Recurring' =&gt; "daily",
 'Location String' =&gt; sched['custrecord_ts_location_string']
}.to_json
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="New" type="Complete" value="@results['Retrieve Current Schedule Record']['Count'].to_i==0">routine_kinetic_submission_create_v1_10</task>
                    <task label="Update" type="Complete" value="@results['Retrieve Current Schedule Record']['Count'].to_i!=0">utilities_echo_v1_31</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_31" name="Check if Updated" x="1390" y="808.3334">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=

previous_values = JSON.parse(@results['Retrieve Current Schedule Record']['Submissions List JSON'])[0]['values']
updated_values = JSON.parse(@results['Schedule Values']['output'])
previous_values.delete('Opportunity Name')
previous_values.delete('Opportunity Number')
previous_values.delete('Schedule Create Date')
previous_values.delete('Schedule Status')

previous_values = previous_values.reject { |k,v| v.nil? || v.empty? || v == "[]" }.sort_by { |k, v| k }
updated_values = updated_values.reject { |k,v| v.nil? || v.empty? || v == "[]" }.sort_by { |k, v| k }
!previous_values.eql?(updated_values)
#previous_values - updated_values
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="Updated" type="Complete" value="@results['Check if Updated']['output']==&quot;true&quot;">routine_kinetic_submission_update_v1_11</task>
                    <task label="Not Updated" type="Complete" value="@results['Check if Updated']['output']!=&quot;true&quot;">system_junction_v1_14</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_37" name="Opportunity Values" x="967" y="219.5">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
opp = JSON.parse(@results['Opportunity JSON']['output'])

{
 'Opportunity Id' =&gt; opp['internalid'],
 'Opportunity Name' =&gt; opp['title'],
 'Opportunity Number' =&gt; opp['tranid'],
 'Opportunity Status' =&gt; opp['entitystatus'],
 'Sales Rep' =&gt; opp['salesrep'],
 'Project Manager' =&gt; opp['projectmanager'],
 'Customer' =&gt; opp['entity'],
 'Status' =&gt; "Active"
}.to_json
%&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="New" type="Complete" value="@results['Retrieve Current Opportunity Record']['Count'].to_i==0">routine_kinetic_submission_create_v1_8</task>
                    <task label="Update" type="Complete" value="@results['Retrieve Current Opportunity Record']['Count'].to_i!=0">routine_kinetic_submission_update_v1_9</task>
                </dependents>
            </task>
            <task definition_id="routine_add_modify_calendar_event" id="routine_add_modify_calendar_event_40" name="Add Modify Calendar Event" x="533.5" y="492.5">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="Input JSON" label="Input JSON" menu="" required="true" tooltip="">&lt;%= @results['Calendar Event JSON']['output'] %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_15</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_41" name="Calendar Event JSON" x="325" y="373">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter dependsOnId="" dependsOnValue="" id="input" label="Input" menu="" required="true" tooltip="">&lt;%= JSON.parse(@request['Body'])['event'].to_json %&gt;</parameter>
                </parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">routine_add_modify_calendar_event_40</task>
                </dependents>
            </task>
        </request>
    </taskTree>
</tree>